<!DOCTYPE html>
<html lang="en">
  <head><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link href="https://fonts.font.im/css?family=Poppins:400,900|Raleway|Roboto:400,900|Roboto+Mono" rel="stylesheet">
<link rel="stylesheet" href="/daviddong.github.io/assets/css/style.css">
<link rel="icon" href="/daviddong.github.io/assets/favicon.ico">

	<!-- default stylesheet monokai.sublime ! -->
	
	<link href="/daviddong.github.io/assets/css/syntax/syntax.monokai.sublime.css" rel="stylesheet"/>
	

<title>Android Fingerprint Framework (1) | David Dong's Blog</title>
<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Android Fingerprint Framework (1) | David Dong’s Blog</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Android Fingerprint Framework (1)" />
<meta name="author" content="david.dong" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Some knowledge for Fingerprint framework in Android platform." />
<meta property="og:description" content="Some knowledge for Fingerprint framework in Android platform." />
<link rel="canonical" href="http://localhost:4000/daviddong.github.io/android/fingerprint/2019/10/03/Fingerprint-frmk1.html" />
<meta property="og:url" content="http://localhost:4000/daviddong.github.io/android/fingerprint/2019/10/03/Fingerprint-frmk1.html" />
<meta property="og:site_name" content="David Dong’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-10-03T15:17:47+08:00" />
<script type="application/ld+json">
{"dateModified":"2019-10-03T15:17:47+08:00","datePublished":"2019-10-03T15:17:47+08:00","url":"http://localhost:4000/daviddong.github.io/android/fingerprint/2019/10/03/Fingerprint-frmk1.html","@type":"BlogPosting","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/daviddong.github.io/BLOG"},"name":"david.dong"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/daviddong.github.io/android/fingerprint/2019/10/03/Fingerprint-frmk1.html"},"author":{"@type":"Person","name":"david.dong"},"headline":"Android Fingerprint Framework (1)","description":"Some knowledge for Fingerprint framework in Android platform.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->




</head>
  <body><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><main class="container">
      <section class="about">
        <a href="/daviddong.github.io/blog/index.html"><img src="/daviddong.github.io/assets/avatar.png" alt="David Dong"></a>
        <h2 id="title">
          <a href="/daviddong.github.io/blog/index.html">David Dong</a>
        </h2>
        <p class="tagline">Java/C/C#/Python</p>
		<!--add navigation --><nav class="navigation">
            <ul>
              
            </ul>
          </nav><!--put dark mode button here --><div>
		  <ul class = "social" >
			<p style = "font-family: Raleway, sans-serif;font-size: 100%">Dark Mode
			  <i class="icon-moon"></i>
			  <label class="switch">
				<input type="checkbox" id="dark-mode-toggle" onclick="toggleDarkMode()">
				<span class="slider round"></span>
			  </label>
			</p>
		  </ul>
		<script type="text/javascript" src="/daviddong.github.io/assets/js/darkmode.js"></script>
		</div><!--put rss/code link here -->
	    <div>
          <ul class="tool"><a style ="margin-right:10px; text-decoration: none" href="/daviddong.github.io/rss.xml">
              <span class="icon-rss-1 tooltip">
				<span class="tooltiptext">Rss</span>
			  </span>
           </a><a style="text-decoration: none" href="https://github.com/gangdong/daviddong.github.io">
              <span class="icon-file-code tooltip">
				<span class="tooltiptext">Code</span>
			  </span>
            </a></ul>
        </div>
	    <!--show contact me -->
	    <div class = "contact"><li>CONTACT ME</li></div>
		<!-- put social link here -->
		<div>
	      <ul class="social" >
		   <a href="https://rainbow-ux.github.io/traveler-blog.github.io">
              <li>
                <i class="icon-picture-3"></i>
              </li>
           </a><a href="https://github.com/gangdong">
              <li>
                <i class="icon-github-circled-1"></i>
              </li>
            </a><a href="https://www.linkedin.com/in/刚-董-25208ba0/">
              <li>
                <i class="icon-linkedin-squared"></i>
              </li>
            </a><a href="mailto:dqdongg@hotmail.com">
              <li>
                <i class="icon-mail" style = "font-size: 27px"></i>
              </li>
            </a></ul>
		</div>
		<!--put timestamp here -->
		<div class ="timestamp">&copy; 2021</div>
	  <!-- about box end here -->
      </section>
      <section class="content">
        


<!-- add menu bar here! -->


<div class="post-container">
	<div  class = "menu-meta">
		<div  class = "menu-logo" style="margin-top: 20px">BLOG</div>
		<div  class = "menu" style = "margin-top: 20px">
			<a class = "icon-doc-text icon_font" href="/daviddong.github.io/blog/index.html">Posts</a><a  class = "icon-archive-1 icon_font" href="/daviddong.github.io/archive">Archives</a><a  class = "icon-tags-1 icon_font" href="/daviddong.github.io/category">Categories</a><a  class = "icon-help-circled-3 icon_font" href="/daviddong.github.io/about">About</a>
		</div>
	</div>
</div><div class="post-container">
  <li class="posts-labelgroup" id="posts-labelgroup">
	<h1 id="posts-label">POST</h1>
  </li>  
  <a class="post-link" href="/daviddong.github.io/android/fingerprint/2019/10/03/Fingerprint-frmk1.html">
    <h2 class="post-title">Android Fingerprint Framework (1)</h2>
  </a>
   <div class="post-meta">
    <div class="post-date icon-calendar" style = "padding-left:0px;font-size:14px">Oct 3, 2019</div>
  </div>
  <br>
</div>
  <!-- post content here! -->
  <!-- set fix width box to put content! -->
  <div class="post-viewer-container">
	<div class="post-fix-width">
		<p>This page is trying to present a brief introduction on android fingerprint framework, aimed at helping anyone who want to learn android fingerprint related knowledge, created by referring some documents and android source code.</p>

<p>There are some articles throughout the internet to share the android fingerprint related knowledge. However, from my point of view, part of them are too complicated to understand and some aren’t very distinct. I wrote this article  by referring android source code and according to my personal working experiences, tried to make the contents simple and easy to understand.</p>

<p>From android 6.0 (API23),android introduced fingerprint API interface, that is FingerprintManager to support fingerprint identification. While at android 8.0 (API26), it is deprecated and replaced by <code class="language-plaintext highlighter-rouge">BiometricPrompt</code> API interface.</p>

<p>Below description is from android official document about fingerprint framework.</p>

<h2 id="architecture">Architecture</h2>
<blockquote>
  <p>The Fingerprint HAL interacts with the following components.</p>
  <ul>
    <li><strong>BiometricManager</strong> interacts directly with an app in an app process. Each app has an instance of IBiometricsFingerprint.hal</li>
    <li><strong>FingerprintService</strong> operates in the system process, which handles communication with fingerprint HAL.</li>
    <li><strong>Fingerprint HAL</strong> is a C/C++ implementation of the IBiometricsFingerprint HIDL interface. This contains the vendor-specific library that communicates with the device-specific hardware.</li>
    <li><strong>Keystore API and Keymaster</strong> components provide hardware-backed cryptography for secure key storage in a secure environment, such as the Trusted Execution Environment (TEE).  <br />
<img src="/daviddong.github.io/assets/image/android-fingerprint-framework-framework.png" alt="framework" class="center-image" />
A vendor-specific HAL implementation must use the communication protocol required by a TEE. Raw images and processed fingerprint features must not be passed in untrusted memory. All such biometric data needs to be stored in the secure hardware such as the TEE. Rooting must not be able to compromise biometric data. <br />
FingerprintService and fingerprintd make calls through the Fingerprint HAL to the vendor-specific library to enroll fingerprints and perform other operations.
<img src="/daviddong.github.io/assets/image/android-fingerprint-framework-tee.png" alt="tee" class="center-image" />    <br />
<br /><br /></li>
  </ul>
</blockquote>

<h2 id="implementation-guidelines">Implementation guidelines</h2>
<p>The following Fingerprint HAL guidelines are designed to ensure that fingerprint data is not leaked and is removed when a user is removed from a device:</p>
<ul>
  <li>Raw fingerprint data or derivatives (for example, templates) must never be accessible from outside the sensor driver or TEE. If the hardware supports a TEE, hardware access must be limited to the TEE and protected by an SELinux policy. The Serial Peripheral Interface (SPI) channel must be accessible only to the TEE and there must be an explicit SELinux policy on all device files.</li>
  <li>Fingerprint acquisition, enrollment, and recognition must occur inside the TEE.</li>
  <li>Only the encrypted form of the fingerprint data can be stored on the file system, even if the file system itself is encrypted.</li>
  <li>Fingerprint templates must be signed with a private, device-specific key. For Advanced Encryption Standard (AES), at a minimum a template must be signed with the absolute file-system path, group, and finger ID such that template files are inoperable on another device or for anyone other than the user that enrolled them on the same device. For example, copying fingerprint data from a different user on the same device or from another device must not work.</li>
  <li>Implementations must either use the file-system path provided by the 
setActiveGroup() function or provide a way to erase all user template data when the user is removed. It’s strongly recommended that fingerprint template files be stored as encrypted and stored in the path provided. If this is infeasible due to TEE storage requirements, the implementer must add hooks to ensure removal of the data when the user is removed.</li>
</ul>

<h2 id="working-process">Working process</h2>
<p>By referring to official introduce, here I summarized the work flow according to my own understanding.</p>

<ol>
  <li>Android starts the fingerprint daemons process-<code class="language-plaintext highlighter-rouge">Fingerprintd</code> during boot up in <code class="language-plaintext highlighter-rouge">init.rc</code>.</li>
  <li>System server will start fingerprint system service <code class="language-plaintext highlighter-rouge">Fingerprint Service</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">Fingerprint Service</code> calls the interface of <code class="language-plaintext highlighter-rouge">Fingerprintd</code> to communicate with the fingerprint HAL code.</li>
  <li>Fingerprint HAL interacts with TA program and the latter undertakes the communication with fingerprint hardware through SPI.</li>
  <li>For the sake of security, the hardware SPI is mounted in the <code class="language-plaintext highlighter-rouge">TEE</code> environment. The data collection of fingerprint image and the related processing of algorithm are all carried out within the <code class="language-plaintext highlighter-rouge">TEE</code> environment. The <code class="language-plaintext highlighter-rouge">REE</code> side only obtains the result of the <code class="language-plaintext highlighter-rouge">TEE</code> side.</li>
</ol>

<p>In the next article, I will make a detailed introduction for the work process by inspecting to the android source code.</p>

<p>To be continued…</p>

	</div>
	<!-- put sidebar! -->
	
	<div class = "sidebar-container">
	    
	    <div class = "sidebar-about-box">
		    
				<li class = "sidebar-title">About This Article</li>
			
			
				
					<li class = "sidebar-about-content sidebar-font-big">Some knowledge for Fingerprint framework in Android platform.</li>
				
				
					<li class = "icon-link-1 sidebar-about-content sidebar-font-big" style = "margin-top:30px">Author: <a href="https://github.com/gangdong">david.dong</a></li>
				
					<li class = "icon-clock-5 sidebar-about-content sidebar-font-big">10 mins to read</li>
					<li class = "icon-book-1 sidebar-about-content sidebar-font-big">3903 words</li>
				
					<li class = "icon-th-list-1 sidebar-about-content sidebar-font-big">Key Words: Fingerprint framework/Android</li>
				
				
				    <li class = "icon-hashtag sidebar-about-content sidebar-font-medium">Tags: 
					
					<a href="/daviddong.github.io/category#Android">Android&nbsp;</a>
					
					<a href="/daviddong.github.io/category#Fingerprint">Fingerprint&nbsp;</a>
					
					</li>
				
			
		</div>
		
		
	    <div class="sidebar-toc-box">
			
			<li class = "sidebar-title">Table of Content</li>
			<li class = "sidebar-font-big sidebar-toc-content"><ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#architecture">Architecture</a></li>
<li class="toc-entry toc-h2"><a href="#implementation-guidelines">Implementation guidelines</a></li>
<li class="toc-entry toc-h2"><a href="#working-process">Working process</a></li>
</ul></li>
			
		</div>
		
	</div>
	 
  </div>
  <!-- no sidebar, use flex width box! -->
  <br><br><br>
  <div class="post-container">
  
  <div class = "share-box-meta">
  <!-- Go to www.addthis.com/dashboard to customize your tools -->
	
	<div class="addthis_inline_share_toolbox share-box"><span style ="padding: 2px">Share:</span></div>
	
	<!-- Put post veiw statistic here! -->
	<div class = "post-view">
		<li class = "icon-eye">&nbsp;<span id="busuanzi_value_page_pv"></span></li>
	</div>
  </div>
  
  <!-- Related posts start here! -->
		
		<h1 id="posts-label">You may also like</h1>
		
	  <div class = "related-posts-box">
		<ul>
			
			<li><a href="/daviddong.github.io/android/fingerprint/2021/02/04/Fingerprint-build-ta.html">Build TA images on different TEE</a></li>
			
			<li><a href="/daviddong.github.io/android/fingerprint/2020/12/02/Fingerprint-Trusty.html">Some useful knowledge for Fingerprint Application on Trusty TEE</a></li>
			
			<li><a href="/daviddong.github.io/android/fingerprint/2020/01/09/Fingerprint-impl-AN8.0.html">Fingerprint implementation in android 8.0 and later</a></li>
			
			<li><a href="/daviddong.github.io/android/fingerprint/2019/12/21/Fingerprint-frmk3.html">Android Fingerprint Framework (3)</a></li>
			
			<li><a href="/daviddong.github.io/android/fingerprint/2019/12/07/Fingerprint-frmk2.html">Android Fingerprint Framework (2)</a></li>
			
		</ul>
	  </div>
	  
	
  <!-- Page navigation start here! -->
   <h1 id="posts-label">further reading</h1>
  
  <div class = "separator"></div>
  <div class="navigation-meta" style = "margin-bottom:40px"><ul class="navigation-bar" style = "margin-top:40px; min-width:40%">
	 
	 <a href="/daviddong.github.io/android/fingerprint/2019/09/15/Fingerprint-enroll.html"; style="width:100%"><span class = "navigation-bar-label">Previous Post</span><br>Fingerprint enrollment in Android</a>
	 
    </ul><ul class="navigation-bar" style = "margin-top:40px; min-width:40%"> 
	 
     <a href="/daviddong.github.io/android/fingerprint/2019/12/07/Fingerprint-frmk2.html"; style="width:100%"><span class = "navigation-bar-label">Next Post</span><br>Android Fingerprint Framework (2)</a>
	 
    </ul></div><br>
  <!-- comment box starts here! -->
    <!-- disqus start  --><!-- Gitalk start  -->
  <!-- Link Gitalk support file  -->
  <section class="gitalk">
  <div id="gitalk_thread"></div>
  <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
  <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
  <script type="text/javascript" src="/daviddong.github.io/assets/js/md5.min.js"></script>
  <div id="gitalk-container"></div>
  <script type="text/javascript">
   var gitalk = new Gitalk({
   // gitalk parameters
   clientID: '5e24fc307693a6df3bc5',
   clientSecret: '28c9c17e1174c705c42e9bdc92f87cadcc4ec8b8',
   repo: 'daviddong.github.io',
   owner: 'gangdong',
   admin: ['gangdong'],
   id: md5(location.pathname),
   title: 'comments'
    });
   gitalk.render('gitalk-container');
  </script>
  </section>
  <!-- Gitalk end -->
  <br/><br/><br/><div class = "footer">© 2012-2021 David Dong. All rights reserved.</div>
  
  <br>
</div>

      </section>
    </main>
<script src="/daviddong.github.io/assets/js/simple-jekyll-search.min.js"></script>
<script src="/daviddong.github.io/assets/js/search.js"></script>


<!-- Go to www.addthis.com/dashboard to customize your tools -->
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-604f502a8198c9c9"></script>

</body>
</html>
